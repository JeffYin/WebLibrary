#{extends 'CRUD/layout.html' /}
#{set title:messages.get('checkout.title') /}

<div id="crudBlank" >

    <h2 id="crudBlankTitle">&{'checkout.inputLibarayCard'}</h2>
    
    <div class="objectForm">
    <form>
        <input type='hidden' name='libraryCardBarcode' value='${flash.libraryCardBarcode}'>
        &{'checkout.scan.item.barcode'}(type 0001): <input name="itemBarcode" id="itemBarcode" type="text" ><br>
        <p class="crudButtons">
            <input type="button" name="_saveAndContinue" value="&{'crud.saveAndContinue', type.modelName}" />
        </p>
         
        <table>
        <thead>
            <tr>
                <th>barcode</th>
                <th>name</th>
                <th width="13%">Action</th>
            </tr>
        </thead>
        <tbody id="itemBody" >
    
        </tbody>
    </table>
    
    </form>
    </div>
    
    <script type="text/javascript">
    
    $("#itemBarcode").keypress(function(e) {
    		if(e.keyCode == 13) {
				//TODO: do ajax call here
				 barcode = $("#itemBarcode").val();
				
				 $.ajax({
						url: "@{BorrowItems.scanItem()}",
						dataType: "json",
						data: {
							barcode: barcode
							//name_startsWith: request.term
						},
						success: function( data ) {
							var item = data;
							var tr = $("<tr></tr>");
							$("<td></td>").html(item.barcode).appendTo(tr);
							$("<td></td>").html(item.name).appendTo(tr);
							$("<td>Delete</td>").appendTo(tr);
							tr.appendTo("#itemBody");
							
							$("#itemBarcode").val("");
							
							},
						
						
						error: function(jqXHR, exception) {
				            if (jqXHR.status === 0) {
				                alert('Not connect.\n Verify Network.');
				            } else if (jqXHR.status == 404) {
				                alert('The barcode is NOT found. [404]');
				            } else if (jqXHR.status == 500) {
				                alert('Internal Server Error [500].');
				            } else {
				            	alert(jqXHR.responseText);
				            }
				        }
							
					});
				 
				 e.stopPropagation();
	    			return false;
    		}
    	});
         
   
    </script>   

</div>